(window.webpackJsonp=window.webpackJsonp||[]).push([[237],{712:function(t,s,e){"use strict";e.r(s);var a=e(17),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"express配置自签名https服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#express配置自签名https服务器"}},[t._v("#")]),t._v(" Express配置自签名https服务器")]),t._v(" "),e("p",[t._v("在nodejs中使用express来搭建框架可以说是非常的简单方便，但是一般默认创建的都是http服务器，也就是只能通过http协议进行访问。如今https已经是发展趋势，我们应该顺应时代的潮流。在本篇文章中，我们将会来使用自签名的方式创建证书，然后使用express框架来搭建https服务器，最后让浏览器或者客户端使用https协议进行访问。")]),t._v(" "),e("h2",{attrs:{id:"http与https"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http与https"}},[t._v("#")]),t._v(" Http与Https")]),t._v(" "),e("h3",{attrs:{id:"介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),e("h4",{attrs:{id:"http"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http"}},[t._v("#")]),t._v(" HTTP")]),t._v(" "),e("p",[t._v("超文本传输协议 (Hypertext transfer protocol) 是一种详细规定了浏览器和万维网服务器之间互相通信的规则，通过因特网传送万维网文档的数据传送协议。")]),t._v(" "),e("h4",{attrs:{id:"https"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#https"}},[t._v("#")]),t._v(" HTTPS")]),t._v(" "),e("p",[t._v("超文本安全传输协议（Hypertext Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）。这个系统的最初研发由网景公司进行，提供了身份验证与加密通讯方法，现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。")]),t._v(" "),e("h3",{attrs:{id:"区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#区别"}},[t._v("#")]),t._v(" 区别")]),t._v(" "),e("ol",[e("li",[t._v("https协议需要到ca申请证书，一般免费证书很少，需要交费。")]),t._v(" "),e("li",[t._v("http是超文本传输协议，信息是明文传输，https 则是具有安全性的ssl加密传输协议。")]),t._v(" "),e("li",[t._v("http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。")]),t._v(" "),e("li",[t._v("http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。")])]),t._v(" "),e("h2",{attrs:{id:"生成证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成证书"}},[t._v("#")]),t._v(" 生成证书")]),t._v(" "),e("h3",{attrs:{id:"生成私钥key文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成私钥key文件"}},[t._v("#")]),t._v(" 生成私钥key文件")]),t._v(" "),e("blockquote",[e("p",[t._v("pathway表示你要保存的文件路径位置")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("openssl genrsa 1024 > /pathway/private.pem\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"生成csr证书签名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成csr证书签名"}},[t._v("#")]),t._v(" 生成CSR证书签名")]),t._v(" "),e("blockquote",[e("p",[t._v("通过上面生成的私钥文件生成CSR证书签名")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("openssl req -new -key /pathway/private.pem -out csr.pem\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"生成证书文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成证书文件"}},[t._v("#")]),t._v(" 生成证书文件")]),t._v(" "),e("blockquote",[e("p",[t._v("通过上述私钥文件和CSR证书签名生成证书文件")])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("openssl x509 -req -days 365 -in csr.pem -signkey /pathway/private.pem -out /pathway/file.crt\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("此时生成的三个文件如下：")]),t._v(" "),e("blockquote",[e("p",[t._v("private.pem: 私钥\ncsr.pem: CSR证书签名\nfile.crt: 证书文件")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://node.hnz.kim/amWiki/img/jianming.png",alt:"img"}})]),t._v(" "),e("h2",{attrs:{id:"与express结合"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#与express结合"}},[t._v("#")]),t._v(" 与Express结合")]),t._v(" "),e("h3",{attrs:{id:"拷贝至express项目目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#拷贝至express项目目录"}},[t._v("#")]),t._v(" 拷贝至Express项目目录")]),t._v(" "),e("p",[t._v("把这生成的这三个文件拷贝到你的nodejs项目目录下，比如我直接在项目根目录下新建certificate文件夹，然后放入三个文件：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("certificate/\n│  \n├── private.pem\n│\n├── private.pem  \n│     \n└── file.crt\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("h3",{attrs:{id:"修改app-js"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改app-js"}},[t._v("#")]),t._v(" 修改app.js")]),t._v(" "),e("p",[t._v("完成以上步骤后，修改项目的启动文件，我这里的启动文件是app.js，或者有人是server.js，以下代码实现都一样：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("var express = require('express'); // 项目服务端使用express框架  \nvar app = express();  \nvar path = require('path');  \nvar fs = require('fs');  \n\n//使用nodejs自带的http、https模块   \nvar https = require('https');\n\n//根据项目的路径导入生成的证书文件  \nvar privateKey  = fs.readFileSync(path.join(__dirname, './certificate/private.pem'), 'utf8');  \nvar certificate = fs.readFileSync(path.join(__dirname, './certificate/file.crt'), 'utf8');  \nvar credentials = {key: privateKey, cert: certificate};\n\nvar httpsServer = https.createServer(credentials, app);  \n\nhttpsServer.listen(SSLPORT, function() {  \n    console.log('HTTPS Server is running on: https://localhost:%s', SSLPORT);  \n});\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br")])]),e("p",[t._v("启动Express")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("node app.js\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("可以看到我们已经成功使用https来访问我们的服务器，但是Chrome浏览器却显示红色的Not Secure，这是因为这个证书是我们自建的，没有经过第三方机构验证，所以会出现警告的提示。")]),t._v(" "),e("h2",{attrs:{id:"第三方机构验证证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第三方机构验证证书"}},[t._v("#")]),t._v(" 第三方机构验证证书")]),t._v(" "),e("p",[t._v("由于我们证书是自己创建的，没有经过第三方机构的验证，所以会出现警告的提示。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("机构")]),t._v(" "),e("th",[t._v("链接")]),t._v(" "),e("th",[t._v("类型")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("godaddy SSL Cert")]),t._v(" "),e("td",[e("a",{attrs:{href:"https://www.godaddy.com/web-security/ssl-certificate",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.godaddy.com/web-security/ssl-certificate"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("收费")])]),t._v(" "),e("tr",[e("td",[t._v("WoSign")]),t._v(" "),e("td",[e("a",{attrs:{href:"https://www.wosign.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.wosign.com"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("免费")])]),t._v(" "),e("tr",[e("td",[t._v("阿里云 DV SSL 证书")]),t._v(" "),e("td",[e("a",{attrs:{href:"https://common-buy.aliyun.com/?commodityCode=cas#/buy",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://common-buy.aliyun.com/?commodityCode=cas#/buy"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("免费")])])])]),t._v(" "),e("h3",{attrs:{id:"使用阿里云免费ssl证书简例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用阿里云免费ssl证书简例"}},[t._v("#")]),t._v(" 使用阿里云免费SSL证书简例")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("var https = require('https');\nvar fs = require('fs');\nvar options = {\n  key: fs.readFileSync('213949634960268.key'),\n  cert: fs.readFileSync('213949634960268.pem')\n};\nvar a = https.createServer(options, function (req, res) {\n  res.writeHead(200);\n  res.end(\"hello world\\n\");\n}).listen(443);\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br")])]),e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("名称")]),t._v(" "),e("th",[t._v("地址")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("nodejs开发——express配置自签名https服务器")]),t._v(" "),e("td",[e("a",{attrs:{href:"http://blog.csdn.net/chenyufeng1991/article/details/60340006",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://blog.csdn.net/chenyufeng1991/article/details/60340006"),e("OutboundLink")],1)])])])])])}),[],!1,null,null,null);s.default=r.exports}}]);