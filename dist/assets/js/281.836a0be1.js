(window.webpackJsonp=window.webpackJsonp||[]).push([[281],{744:function(t,e,a){"use strict";a.r(e);var s=a(17),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"条件编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件编译"}},[t._v("#")]),t._v(" 条件编译")]),t._v(" "),a("h2",{attrs:{id:"跨端兼容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨端兼容"}},[t._v("#")]),t._v(" 跨端兼容")]),t._v(" "),a("p",[t._v("uni-app 已将常用的组件、JS API 封装到框架中，开发者按照 uni-app 规范开发即可保证多平台兼容，大部分业务均可直接满足。")]),t._v(" "),a("p",[t._v("但每个平台有自己的一些特性，因此会存在一些无法跨平台的情况。")]),t._v(" "),a("ul",[a("li",[t._v("大量写 if else，会造成代码执行性能低下和管理混乱。")]),t._v(" "),a("li",[t._v("编译到不同的工程后二次修改，会让后续升级变的很麻烦。")])]),t._v(" "),a("p",[t._v("在 C 语言中，通过 #ifdef、#ifndef 的方式，为 windows、mac 等不同 os 编译不同的代码。 "),a("code",[t._v("uni-app")]),t._v(" 参考这个思路，为 "),a("code",[t._v("uni-app")]),t._v(" 提供了条件编译手段，在一个工程里优雅的完成了平台个性化实现。")]),t._v(" "),a("h2",{attrs:{id:"条件编译-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件编译-2"}},[t._v("#")]),t._v(" 条件编译")]),t._v(" "),a("p",[t._v("条件编译是用特殊的注释作为标记，在编译时根据这些特殊的注释，将注释里面的代码编译到不同平台。")]),t._v(" "),a("p",[t._v("**写法：**以 #ifdef 或 #ifndef 加 "),a("strong",[t._v("%PLATFORM%")]),t._v(" 开头，以 #endif 结尾。")]),t._v(" "),a("ul",[a("li",[t._v("#ifdef：if defined 仅在某平台存在")]),t._v(" "),a("li",[t._v("#ifndef：if not defined 除了某平台均存在")]),t._v(" "),a("li",[a("strong",[t._v("%PLATFORM%")]),t._v("：平台名称")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("条件编译写法")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("#ifdef "),a("strong",[t._v("APP-PLUS")]),t._v(" 需条件编译的代码 #endif")]),t._v(" "),a("td",[t._v("仅出现在 5+App 平台下的代码")])]),t._v(" "),a("tr",[a("td",[t._v("#ifndef "),a("strong",[t._v("H5")]),t._v(" 需条件编译的代码 #endif")]),t._v(" "),a("td",[t._v("除了 H5 平台，其它平台均存在的代码")])]),t._v(" "),a("tr",[a("td",[t._v("#ifdef "),a("strong",[t._v("H5")]),t._v(" || "),a("strong",[t._v("MP-WEIXIN")]),t._v(" 需条件编译的代码 #endif")]),t._v(" "),a("td",[t._v("仅在 H5 平台或微信小程序平台存在的代码")])])])]),t._v(" "),a("p",[a("strong",[t._v("%PLATFORM%")]),t._v(" "),a("strong",[t._v("可取值如下：")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("平台")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("参考文档")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("APP-PLUS")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("5+App")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"http://www.html5plus.org/doc/",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTML5+ 规范"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("APP-PLUS-NVUE")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("5+App nvue")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://weex.apache.org/cn/guide/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Weex 规范"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("H5")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("H5")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("MP-WEIXIN")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("微信小程序")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信小程序"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("MP-ALIPAY")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("支付宝小程序")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.alipay.com/mini/developer/getting-started",target:"_blank",rel:"noopener noreferrer"}},[t._v("支付宝小程序"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("MP-BAIDU")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("百度小程序")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://smartprogram.baidu.com/docs/develop/tutorial/codedir/",target:"_blank",rel:"noopener noreferrer"}},[t._v("百度小程序"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("MP-TOUTIAO")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("头条小程序")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://developer.toutiao.com/docs/framework/",target:"_blank",rel:"noopener noreferrer"}},[t._v("头条小程序"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("MP-QQ")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("QQ小程序")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("（目前仅cli版支持）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("MP")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("微信小程序/支付宝小程序/百度小程序/头条小程序/QQ小程序")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})])])]),t._v(" "),a("p",[a("strong",[t._v("支持的文件")])]),t._v(" "),a("ul",[a("li",[t._v(".vue")]),t._v(" "),a("li",[t._v(".js")]),t._v(" "),a("li",[t._v(".css")]),t._v(" "),a("li",[t._v("pages.json")]),t._v(" "),a("li",[t._v("各预编译语言文件，如：.scss、.less、.stylus、.ts、.pug")])]),t._v(" "),a("p",[a("strong",[t._v("注意：")]),t._v(" 条件编译是利用注释实现的，在不同语法里注释写法不一样，js使用 "),a("code",[t._v("// 注释")]),t._v("、css 使用 "),a("code",[t._v("/* 注释 */")]),t._v("、vue/nvue 模板里使用 "),a("code",[t._v("\x3c!-- 注释 --\x3e")]),t._v("；")]),t._v(" "),a("h3",{attrs:{id:"api-的条件编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api-的条件编译"}},[t._v("#")]),t._v(" API 的条件编译")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #ifdef  %PLATFORM%")]),t._v("\n平台特有的"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("API")]),t._v("实现\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #endif")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("示例，如下代码仅在 5+App 下出现:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/img/platform-7.png",alt:"img"}})]),t._v(" "),a("p",[t._v("示例，如下代码不会在 H5 平台上出现：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/img/platform-6.png",alt:"img"}})]),t._v(" "),a("p",[t._v("除了支持单个平台的条件编译外，还支持"),a("strong",[t._v("多平台")]),t._v("同时编译，使用 || 来分隔平台名称。")]),t._v(" "),a("p",[t._v("示例，如下代码会在 5+App 和 H5 平台上出现：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/img/platform-5.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"组件的条件编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件的条件编译"}},[t._v("#")]),t._v(" 组件的条件编译")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--  #ifdef  %PLATFORM% --\x3e")]),t._v("\n平台特有的组件\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--  #endif --\x3e")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("示例，如下广告组件仅会在微信小程序中出现：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/img/platform-1.1.png",alt:"uniapp"}})]),t._v(" "),a("h3",{attrs:{id:"样式的条件编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#样式的条件编译"}},[t._v("#")]),t._v(" 样式的条件编译")]),t._v(" "),a("div",{staticClass:"language-css line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*  #ifdef  %PLATFORM%  */")]),t._v("\n平台特有样式\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*  #endif  */")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[a("strong",[t._v("注意：")]),t._v(" 样式的条件编译，无论是 css 还是 sass/scss/less/stylus 等预编译语言中，必须使用 "),a("code",[t._v("/*注释*/")]),t._v(" 的写法。")]),t._v(" "),a("p",[t._v("正确写法")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/img/platform-2.png",alt:"img"}})]),t._v(" "),a("p",[t._v("错误写法")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/img/platform-3.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"pages-json-的条件编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pages-json-的条件编译"}},[t._v("#")]),t._v(" pages.json 的条件编译")]),t._v(" "),a("p",[t._v("下面的页面，只有运行至 5+App 时才会编译进去。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/img/platform-4.png",alt:"img"}})]),t._v(" "),a("p",[t._v("不同平台下的特有功能，以及小程序平台的分包，都可以通过 pages.json 的条件编译来更好地实现。这样，就不会在其它平台产生多余的资源，进而减小包体积。")]),t._v(" "),a("p",[t._v("json的条件编译，如不同平台的key名称相同，cli项目下开发者自己安装的校验器会报错，需自行关闭这些校验器对json相同key的校验规则。如果使用HBuilderX的校验器，无需在意此问题，HBuilderX的语法校验器为此优化过。")]),t._v(" "),a("h3",{attrs:{id:"static-目录的条件编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#static-目录的条件编译"}},[t._v("#")]),t._v(" static 目录的条件编译")]),t._v(" "),a("p",[t._v("在不同平台，引用的静态资源可能也存在差异，通过 static 的的条件编译可以解决此问题，static 目录下新建不同平台的专有目录（目录名称同 "),a("code",[t._v("%PLATFORM%")]),t._v(" 值域,但字母均为小写），专有目录下的静态资源只有在特定平台才会编译进去。")]),t._v(" "),a("p",[t._v("如以下目录结构，"),a("code",[t._v("a.png")]),t._v(" 只有在微信小程序平台才会编译进去，"),a("code",[t._v("b.png")]),t._v(" 在所有平台都会被编译。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("┌─static                \n│  ├─mp-weixin\n│  │  └─a.png     \n│  └─b.png\n├─main.js        \n├─App.vue      \n├─manifest.json \n└─pages.json     \n    \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h3",{attrs:{id:"整体目录条件编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体目录条件编译"}},[t._v("#")]),t._v(" 整体目录条件编译")]),t._v(" "),a("p",[t._v("如果想把各平台的页面文件更彻底的分开，也可以在uni-app项目根目录创建"),a("code",[t._v("platforms")]),t._v("目录，然后在下面进一步创建APP-PLUS、MP-WEIXIN等子目录，存放不同平台的文件。")]),t._v(" "),a("h3",{attrs:{id:"hbuilderx-支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hbuilderx-支持"}},[t._v("#")]),t._v(" HBuilderX 支持")]),t._v(" "),a("p",[t._v("HBuilderX 为 "),a("code",[t._v("uni-app")]),t._v(" 的条件编译提供了丰富的支持:")]),t._v(" "),a("p",[a("strong",[t._v("代码块支持")])]),t._v(" "),a("p",[t._v("在 HBuilderX 中开发 "),a("code",[t._v("uni-app")]),t._v(" 时，通过输入 "),a("strong",[t._v("ifdef")]),t._v(" 可快速生成条件编译的代码片段")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/uni-022402.png",alt:"img"}})]),t._v(" "),a("p",[a("strong",[t._v("语法高亮")])]),t._v(" "),a("p",[t._v("在 HBuilderX 中对条件编译的代码注释部分提供了语法高亮，可分辨出写法是否正确，使得代码更加清晰（独立js文件需在编辑器右下角切换javascript es6+编辑器，独立css文件暂不支持高亮，但不高亮不影响使用）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/uni-012403.png",alt:"img"}})]),t._v(" "),a("p",[a("strong",[t._v("正确注释和快速选中")])]),t._v(" "),a("p",[t._v("在 HBuilderX 中，ctrl+alt+/ 即可生成正确注释（js："),a("code",[t._v("// 注释")]),t._v("、css："),a("code",[t._v("/* 注释 */")]),t._v("、vue/nvue模板： "),a("code",[t._v("\x3c!-- 注释 --\x3e")]),t._v("）。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/uni2019012801.png",alt:"img"}})]),t._v(" "),a("p",[t._v("点击 "),a("strong",[t._v("ifdef")]),t._v(" 或 "),a("strong",[t._v("endif")]),t._v(" 可快速选中条件编译部分；点击左侧的折叠图标，可折叠条件编译部分代码。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/doc/uni-012501.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[t._v("#")]),t._v(" 注意")]),t._v(" "),a("ul",[a("li",[t._v("Android 和 iOS 平台不支持通过条件编译来区分，如果需要区分 Android、iOS 平台，请通过调用 uni.getSystemInfo 来获取平台信息。在HBuilderX1.9.10起，支持"),a("code",[t._v("ifios")]),t._v("、"),a("code",[t._v("ifAndroid")]),t._v("代码块，可方便编写判断。")]),t._v(" "),a("li",[t._v("有些跨端工具可以提供js的条件编译或多态，但这对于实际开发远远不够。uni-app不止是处理js，任何代码都可以多端条件编译，才能真正解决实际项目的跨端问题。另外所谓多态在实际开发中会造成大量冗余代码，很不利于复用和维护。举例，微信小程序主题色是绿色，而百度支付宝小程序是蓝色，你的应用想分平台适配颜色，只有条件编译是代码量最低、最容易维护的。")]),t._v(" "),a("li",[t._v("有些公司的产品运营总是给不同平台提不同需求，但这不是拒绝uni-app的理由。关键在于项目里，复用的代码多还是个性的代码多，正常都是复用的代码多，所以仍然应该多端。而个性的代码放到不同平台的目录下，差异化维护。")])])])}),[],!1,null,null,null);e.default=n.exports}}]);