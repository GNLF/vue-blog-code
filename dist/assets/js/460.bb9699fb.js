(window.webpackJsonp=window.webpackJsonp||[]).push([[460],{926:function(e,a,s){"use strict";s.r(a);var n=s(17),r=Object(n.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"独立分包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#独立分包"}},[e._v("#")]),e._v(" 独立分包")]),e._v(" "),s("blockquote",[s("p",[e._v("微信客户端 6.7.2，基础库 "),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.3.0"),s("OutboundLink")],1),e._v(" 及以上版本开始支持。开发者工具请使用 1.02.1808300 及以上版本，可"),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("点此下载"),s("OutboundLink")],1),e._v("。")])]),e._v(" "),s("p",[e._v("独立分包是小程序中一种特殊类型的分包，可以独立于主包和其他分包运行。从独立分包中页面进入小程序时，不需要下载主包。当用户进入普通分包或主包内页面时，主包才会被下载。")]),e._v(" "),s("p",[e._v("开发者可以按需将某些具有一定功能独立性的页面配置到独立分包中。当小程序从普通的分包页面启动时，需要首先下载主包；而独立分包不依赖主包即可运行，可以很大程度上提升分包页面的启动速度。")]),e._v(" "),s("p",[e._v("一个小程序中可以有多个独立分包。")]),e._v(" "),s("blockquote",[s("p",[e._v("小游戏不支持独立分包。")])]),e._v(" "),s("h3",{attrs:{id:"配置方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置方法"}},[e._v("#")]),e._v(" 配置方法")]),e._v(" "),s("p",[e._v("假设小程序目录结构如下：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("├── app.js\n├── app.json\n├── app.wxss\n├── moduleA\n│   └── pages\n│       ├── rabbit\n│       └── squirrel\n├── moduleB\n│   └── pages\n│       ├── pear\n│       └── pineapple\n├── pages\n│   ├── index\n│   └── logs\n└── utils\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br")])]),s("p",[e._v("开发者通过在"),s("code",[e._v("app.json")]),e._v("的"),s("code",[e._v("subpackages")]),e._v("字段中对应的分包配置项中定义"),s("code",[e._v("independent")]),e._v("字段声明对应分包为独立分包。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('{\n  "pages": ["pages/index", "pages/logs"],\n  "subpackages": [\n    {\n      "root": "moduleA",\n      "pages": ["pages/rabbit", "pages/squirrel"]\n    },\n    {\n      "root": "moduleB",\n      "pages": ["pages/pear", "pages/pineapple"],\n      "independent": true\n    }\n  ]\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br")])]),s("h3",{attrs:{id:"限制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#限制"}},[e._v("#")]),e._v(" 限制")]),e._v(" "),s("p",[e._v("独立分包属于分包的一种。普通分包的所有限制都对独立分包有效。独立分包中插件、自定义组件的处理方式同普通分包。")]),e._v(" "),s("p",[e._v("此外，使用独立分包时要注意：")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("独立分包中不能依赖主包和其他分包中的内容")]),e._v("，包括js文件、template、wxss、自定义组件、插件等。主包中的"),s("code",[e._v("app.wxss")]),e._v("对独立分包无效，应避免在独立分包页面中使用 "),s("code",[e._v("app.wxss")]),e._v(" 中的样式；")]),e._v(" "),s("li",[s("code",[e._v("App")]),e._v(" 只能在主包内定义，独立分包中不能定义 "),s("code",[e._v("App")]),e._v("，会造成无法预期的行为；")]),e._v(" "),s("li",[e._v("独立分包中暂时不支持使用插件。")])]),e._v(" "),s("h3",{attrs:{id:"注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[e._v("#")]),e._v(" 注意事项")]),e._v(" "),s("h4",{attrs:{id:"_1-关于-getapp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-关于-getapp"}},[e._v("#")]),e._v(" （1）关于 "),s("code",[e._v("getApp()")])]),e._v(" "),s("p",[e._v("与普通分包不同，独立分包运行时，"),s("code",[e._v("App")]),e._v(" 并不一定被注册，因此 "),s("code",[e._v("getApp()")]),e._v(" 也不一定可以获得 "),s("code",[e._v("App")]),e._v(" 对象：")]),e._v(" "),s("ul",[s("li",[e._v("当用户从独立分包页面启动小程序时，主包不存在，"),s("code",[e._v("App")]),e._v("也不存在，此时调用 "),s("code",[e._v("getApp()")]),e._v(" 获取到的是 "),s("code",[e._v("undefined")]),e._v("。 当用户进入普通分包或主包内页面时，主包才会被下载，"),s("code",[e._v("App")]),e._v(" 才会被注册。")]),e._v(" "),s("li",[e._v("当用户是从普通分包或主包内页面跳转到独立分包页面时，主包已经存在，此时调用 "),s("code",[e._v("getApp()")]),e._v(" 可以获取到真正的 "),s("code",[e._v("App")]),e._v("。")])]),e._v(" "),s("p",[e._v("由于这一限制，开发者无法通过 "),s("code",[e._v("App")]),e._v(" 对象实现独立分包和小程序其他部分的全局变量共享。")]),e._v(" "),s("p",[e._v("为了在独立分包中满足这一需求，基础库 "),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.2.4"),s("OutboundLink")],1),e._v(" 版本开始 "),s("code",[e._v("getApp")]),e._v("支持 "),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/app.html#getappobject",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("allowDefault")]),s("OutboundLink")],1),e._v("参数，在 "),s("code",[e._v("App")]),e._v(" 未定义时返回一个默认实现。当主包加载，"),s("code",[e._v("App")]),e._v(" 被注册时，默认实现中定义的属性会被覆盖合并到真正的 "),s("code",[e._v("App")]),e._v(" 中。")]),e._v(" "),s("p",[s("strong",[e._v("示例代码：")])]),e._v(" "),s("ul",[s("li",[e._v("独立分包中")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("const app = getApp({allowDefault: true}) // {}\napp.data = 456\napp.global = {}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("ul",[s("li",[e._v("app.js 中")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("App({\n  data: 123,\n  other: 'hello'\n})\n\nconsole.log(getApp()) // {global: {}, data: 456, other: 'hello'}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h4",{attrs:{id:"_2-关于-app-生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-关于-app-生命周期"}},[e._v("#")]),e._v(" （2）关于 "),s("code",[e._v("App")]),e._v(" 生命周期")]),e._v(" "),s("p",[e._v("当从独立分包启动小程序时，主包中 "),s("code",[e._v("App")]),e._v(" 的 "),s("code",[e._v("onLaunch")]),e._v(" 和首次 "),s("code",[e._v("onShow")]),e._v(" 会在从独立分包页面首次进入主包或其他普通分包页面时调用。")]),e._v(" "),s("p",[e._v("由于独立分包中无法定义 "),s("code",[e._v("App")]),e._v("，小程序生命周期的监听可以使用 "),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wx.onAppShow.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("wx.onAppShow")]),s("OutboundLink")],1),e._v("，"),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wx.onAppHide.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("wx.onAppHide")]),s("OutboundLink")],1),e._v(" 完成。"),s("code",[e._v("App")]),e._v(" 上的其他事件可以使用 "),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wx.onError.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("wx.onError")]),s("OutboundLink")],1),e._v("，"),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wx.onPageNotFound.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("wx.onPageNotFound")]),s("OutboundLink")],1),e._v(" 监听。")]),e._v(" "),s("h3",{attrs:{id:"低版本兼容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#低版本兼容"}},[e._v("#")]),e._v(" 低版本兼容")]),e._v(" "),s("p",[e._v("在低于6.7.2版本的微信中运行时，独立分包视为普通分包处理，不具备独立运行的特性。")]),e._v(" "),s("p",[s("strong",[e._v("注意：在兼容模式下，主包中的 app.wxss 可能会对独立分包中的页面产生影响，因此应避免在独立分包页面中使用 app.wxss 中的样式。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);