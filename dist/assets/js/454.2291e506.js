(window.webpackJsonp=window.webpackJsonp||[]).push([[454],{917:function(s,a,n){"use strict";n.r(a);var e=n(17),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"数据监听器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据监听器"}},[s._v("#")]),s._v(" 数据监听器")]),s._v(" "),n("p",[s._v("数据监听器可以用于监听和响应任何属性和数据字段的变化。从小程序基础库版本 "),n("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("2.6.1"),n("OutboundLink")],1),s._v(" 开始支持。")]),s._v(" "),n("h2",{attrs:{id:"使用数据监听器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用数据监听器"}},[s._v("#")]),s._v(" 使用数据监听器")]),s._v(" "),n("p",[s._v("有时，在一些数据字段被 setData 设置时，需要执行一些操作。")]),s._v(" "),n("p",[s._v("例如， "),n("code",[s._v("this.data.sum")]),s._v(" 永远是 "),n("code",[s._v("this.data.numberA")]),s._v(" 与 "),n("code",[s._v("this.data.numberB")]),s._v(" 的和。此时，可以使用数据监听器进行如下实现。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Component({\n  attached() {\n    this.setData({\n      numberA: 1,\n      numberB: 2,\n    })\n  },\n  observers: {\n    'numberA, numberB': function (numberA, numberB) {\n      // 在 numberA 或者 numberB 被设置时，执行这个函数\n      this.setData({\n        sum: numberA + numberB\n      })\n    }\n  }\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://developers.weixin.qq.com/s/FUZF9ams7g6N",target:"_blank",rel:"noopener noreferrer"}},[s._v("在开发者工具中预览效果"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"监听字段语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#监听字段语法"}},[s._v("#")]),s._v(" 监听字段语法")]),s._v(" "),n("p",[s._v("数据监听器支持监听属性或内部数据的变化，可以同时监听多个。一次 setData 最多触发每个监听器一次。")]),s._v(" "),n("p",[s._v("同时，监听器可以监听子数据字段，如下例所示。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Component({\n  observers: {\n    'some.subfield': function (subfield) {\n      // 使用 setData 设置 this.data.some.subfield 时触发\n      // （除此以外，使用 setData 设置 this.data.some 也会触发）\n      subfield === this.data.some.subfield\n    },\n    'arr[12]': function (arr12) {\n      // 使用 setData 设置 this.data.arr[12] 时触发\n      // （除此以外，使用 setData 设置 this.data.arr 也会触发）\n      arr12 === this.data.arr[12]\n    },\n  }\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("如果需要监听所有子数据字段的变化，可以使用通配符 "),n("code",[s._v("**")]),s._v(" 。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Component({\n  observers: {\n    'some.field.**': function (field) {\n      // 使用 setData 设置 this.data.some.field 本身或其下任何子数据字段时触发\n      // （除此以外，使用 setData 设置 this.data.some 也会触发）\n      field === this.data.some.field\n    },\n  },\n  attached() {\n    // 这样会触发上面的 observer\n    this.setData({\n      'some.field': { /* ... */ }\n    })\n    // 这样也会触发上面的 observer\n    this.setData({\n      'some.field.xxx': { /* ... */ }\n    })\n    // 这样还是会触发上面的 observer\n    this.setData({\n      some: { /* ... */ }\n    })\n  }\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("特别地，仅使用通配符 "),n("code",[s._v("**")]),s._v(" 可以监听全部 setData 。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Component({\n  observers: {\n    '**': function () {\n      // 每次 setData 都触发\n    },\n  },\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("strong",[s._v("Bugs & Tips:")])]),s._v(" "),n("ul",[n("li",[s._v("数据监听器监听的是 setData 涉及到的数据字段，即使这些数据字段的值没有发生变化，数据监听器依然会被触发。")]),s._v(" "),n("li",[s._v("如果在数据监听器函数中使用 setData 设置本身监听的数据字段，可能会导致死循环，需要特别留意。")]),s._v(" "),n("li",[s._v("数据监听器和属性的 observer 相比，数据监听器更强大且通常具有更好的性能。")])])])}),[],!1,null,null,null);a.default=t.exports}}]);