# 项目总结

## 微信 H5 项目

> 经验总结

### 判断是否为 IOS

  ```js
  var u = navigator.userAgent
  this.isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/) //ios终端
  ```

### 全局引入`jQuery`的方式

  ```js
  // vue.config.js
  const webpack = require('webpack')

  module.exports = {
    chainWebpack: (config) => {
      new webpack.ProvidePlugin({
        $: 'jquery',
        jQuery: 'jquery',
        'windows.jQuery': 'jquery',
      })
    },
  }
  // 全局引入 main.js
  import jQuery from 'jquery'
  window.$ = window.jQuery = jQuery
  // 局部引入
  import jQuery from 'jquery'
  let $ = jQuery
  ```

### 微信分享

  > 路由模式为 History
  >
  > 每个页面单独设置分享

  ```js
  import wechat from '@/components/jweixin-module/wechat.js'
  Vue.mixin({
    onLoad() {
      wechat.share(window.location.href)
    },
  })
  ```

### 微信 H5 授权登录

  ```javascript
  Vue.prototype.$wxauth = function(navitourl) {
    // window.location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx117c7bbba7314fb8&redirect_uri="+encodeURIComponent(navitourl)+"&response_type=code&scope=snsapi_userinfo&state=123&connect_redirect=1#wechat_redirect");
    window.location.replace(navitourl)
  }
  Vue.prototype.$getURLParameter = function(name) {
    return (
      decodeURIComponent(
        (new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(
          window.location.href
        ) || [, ''])[1].replace(/\+/g, '%20')
      ) || null
    )
  }
  ```

### `vuex`持久化存储

  ```js
  import Vue from 'vue'
  import Vuex from 'vuex'
  import createPersistedState from 'vuex-persistedstate'
  const store = new Vuex.Store({
    //全局变量定义
    // 状态持久化
    plugins: [
      createPersistedState({
        storage: {
          getItem: (key) => wx.getStorageSync(key),
          setItem: (key, value) => wx.setStorageSync(key, value),
          removeItem: (key) => {},
        },
      }),
    ],
    state: {},
    mutations: {},
    actions: {},
  })
  export default store
  ```

### `turnjs`翻书效果的使用

  ```js
  // 首先引入 jquery
  import $ from 'jquery'
  import './book/js/turn.js'
  export default {
    mounted() {
      this.bookCreate()
      this.previousPage = $('.previousPage') //上一页
      this.nextPage = $('.nextPage') //下一页
      this.flipbook = $('.flipbook') // turn实例
      this.previousPage.bind('click', this.bookPre) // 绑定上一页事件
      this.nextPage.bind('click', this.bookNext) //  绑定下一页事件
    },
    methods: {
      // 上一页
      bookPre() {
        if (this.flipbook.turn('page') == this.currentPage - 1) return
        if (this.currentPage > 1) {
          this.flipbook.turn('page', this.currentPage - 1)
        }
      },
      // 下一页
      bookNext() {
        if (this.flipbook.turn('page') == this.currentPage + 1) return
        if (this.currentPage < this.bookList.length) {
          this.flipbook.turn('page', this.currentPage + 1)
        }
      },
      // 创建实例
      bookCreate() {
        let that = this
        var w = $(window).width()
        var h = $(window).height()
        $('.flipbook').turn({
          // 配置参数
          width: (260 * 375) / w, //宽度
          height: (376 * 667) / h, //高度
          elevation: 50,
          display: 'single', // 翻页模式 此为单页 默认双页
          duration: 600, // 动画持续时间
          gradients: true, // 翻书
          autoCenter: true,
          when: {
            turning: function(e, page, view) {},
            turned: function(e, page, view) {
              //翻页完成后触发事件
            },
          },
        })
      },
    },
  }
  ```

### 页面引入优酷连接视频

  ```js
  import 'youkuApi.js'
  export default {
    mounted() {
      let that = this
      let player = new YKU.Player('youkuplayer', {
        styleid: '0',
        client_id: '737a894e1d85fe36',
        vid: this.vId, // 视频ID必填
        newPlayer: true,
        autoplay: false,
        isAutoplayMute: false,
        events: {
          //事件触发
          onPlayerReady: function() {},
          onPlayStart: function() {},
          onPlayEnd: function() {},
        },
      })
    },
  }
  ```

## CreateJS

### SoundJS

```js
// 声明注册文件类型
createjs.Sound.alternateExtensions = ['mp3']
// 注册文件 $1路径 $2ID
createjs.Sound.registerSound('static/music/0.mp3', 'bg')
// 文件载入事件
createjs.Sound.on('fileload', (evt) => {
  if (evt.data == 100) this.bgMusicLoad = true
})
// 播放属性设置
var createBgConfig = new createjs.PlayPropsConfig().set({
  interrupt: createjs.Sound.INTERRUPT_ANY,
  loop: 1, // 循环播放 0一次 1无数次
  volume: 0.8, // 声音大小 0-1
})
//
createjs.Sound.play('bg', this.createBgConfig)
```
